<!DOCTYPE html>
<meta charset="utf-8">
<style>
	.link line {
		stroke: #696969;
	}

	.link line.separator {
		stroke: #fff;
		stroke-width: 2px;
	}

	.node circle {
		stroke: #000;
		fill: #444;
		stroke-width: 1.5px;
	}

	.node text {
		font: 10px sans-serif;
		pointer-events: none;
	}

</style>
<body>
	<script src="js/d3.v3.min.js"></script>
	<script>
		var width = 960;
		var height = 500;

		var authRadius = 12
		var publRadius = 10;
		var linkRadius = 60;

		var color = d3.scale.category20();

		var radius = d3.scale.sqrt().range([0, 6]);

		var svg = d3.select("body").append("svg")
		            .attr("width", width)
		            .attr("height", height);

		var force = d3.layout
		              .force()
		              .size([width, height])
		              .charge(-400)
		              .linkDistance(function(d) { return linkRadius; })
		;

		d3.json("data/coauthor.json", function(error, graph) {
			if (error) throw error;

			function tick() {
				link
				    .selectAll("line")
				    .attr("x1", function(d) { return d.source.x; })
				    .attr("y1", function(d) { return d.source.y; })
				    .attr("x2", function(d) { return d.target.x; })
				    .attr("y2", function(d) { return d.target.y; });
				node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
			}

			force
			     .nodes(graph.nodes)
			     .links(graph.links)
			     .on("tick", tick)
			     .start();

			var link = svg
			               .selectAll(".link")
			               .data(graph.links)
			               .enter().append("g")
			               .attr("class", "link");

			link
			    .append("line")
			    .style("stroke-width", function(d) {return 2+"px"});

			link
			    .filter(function(d) { return d.bond > 1; }).append("line")
			    .attr("class", "separator");

			var node = svg
			              .selectAll(".node")
			              .data(graph.nodes)
			              .enter().append("g")
			              .attr("class", "node")
			              .call(force.drag)
			;

			function getRadius(d) {
				if (d.type == "auth") return authRadius
				if (d.type == "publ") return publRadius
				return nodeRadius
			}
			function getRadiusObj(d) {
				return radius(getRadius(d));
			}
			function handleMouseClick(d, i) {
				if (d.expanded) return;
				d.expanded = true;

				d3.select(this)
				  .style("fill", color(d.type) )
				;
			}
			function handleMouseOver(d, i) {
				if (d.expanded) return;
				d3.select(this)
				  .attr("r", radius(getRadius(d)+2))
				;
			}
			function handleMouseOut(d, i) {
				if (d.expanded) return;
				d3.select(this)
				  .attr("r", radius(getRadius(d)))
				;
			}

			node
			    .filter(function(d) { return d.type == "auth"; })
			    .append("circle")
			    .attr("r", getRadiusObj)
			    .on("click", handleMouseClick)
			    .on("mouseover", handleMouseOver)
			    .on("mouseout",  handleMouseOut)
			;

			node
			    .filter(function(d) { return d.type == "publ"; })
			    .append("circle")
			    .attr("r", getRadiusObj)
			    .on("click", handleMouseClick)
			    .on("mouseover", handleMouseOver)
			    .on("mouseout",  handleMouseOut)
			;


			node
			    .append("text")
			    .attr("dy", ".35em")
			    .attr("text-anchor", "middle")
			    .text(function(d) { return d.name; })
			;
		});
	</script>
</body>
